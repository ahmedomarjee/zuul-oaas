<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:mongo="http://www.springframework.org/schema/data/mongo"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
       http://www.springframework.org/schema/data/mongo http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd">


    <!--
        Embedded MongoDB
        It's not truly embedded 'cause there's no Java implementation of the MongoDB. This factory
        initializes embedmongo.flapdoodle.de that is able to download original MongoDB binary for
        your platform and run it for your integration tests.
    -->
    <bean id="mongo" class="cz.jirutka.mongo.embed.EmbeddedMongoFactoryBean"
          p:version="2.2" />

    <mongo:db-factory mongo-ref="mongo" id="mongoDbFactory" dbname="authtest" write-concern="SAFE" />

    <mongo:mapping-converter id="mappingConverter" db-factory-ref="mongoDbFactory">
        <mongo:custom-converters base-package="cz.cvut.zuul.oaas.dao.mongo.converters" />
    </mongo:mapping-converter>

    <bean id="conversionService" class="org.springframework.context.support.ConversionServiceFactoryBean" />

    <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
        <constructor-arg name="mongoDbFactory" ref="mongoDbFactory" />
        <constructor-arg name="mongoConverter" ref="mappingConverter" />
        <property name="writeResultChecking" value="EXCEPTION" />
    </bean>


    <bean id="accessTokensRepo" class="cz.cvut.zuul.oaas.dao.mongo.MongoAccessTokensRepo"
          p:mongoOperations-ref="mongoTemplate" />

    <bean id="refreshTokensRepo" class="cz.cvut.zuul.oaas.dao.mongo.MongoRefreshTokensRepo"
          p:mongoOperations-ref="mongoTemplate" />

    <bean id="clientsRepo" class="cz.cvut.zuul.oaas.dao.mongo.MongoClientsRepo"
          p:mongoOperations-ref="mongoTemplate"  />

    <bean id="resourcesRepo" class="cz.cvut.zuul.oaas.dao.mongo.MongoResourcesRepo"
          p:mongoOperations-ref="mongoTemplate"  />

</beans>
