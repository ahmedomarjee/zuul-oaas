<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
       http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd">


    <!--////////// Web Context Configuration //////////-->


    <!-- Enables the Spring MVC @Controller programming model -->
    <mvc:annotation-driven />
    <mvc:default-servlet-handler />


    <!--///// Template engine /////-->

    <bean class="org.thymeleaf.spring3.view.ThymeleafViewResolver"
          p:templateEngine-ref="templateEngine"
          p:contentType="text/html;charset=UTF-8" />

    <bean id="templateEngine" class="org.thymeleaf.spring3.SpringTemplateEngine"
          p:additionalDialects-ref="thymeleafDialects"
          p:templateResolver-ref="templateResolver"
          p:messageSource-ref="messageSource" />

    <bean id="templateResolver" class="org.thymeleaf.templateresolver.ServletContextTemplateResolver"
          p:prefix="/WEB-INF/templates/"
          p:suffix=".html"
          p:characterEncoding="utf-8"
          p:templateMode="HTML5"
          p:cacheable="false" />

    <bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource"
          p:basename="/WEB-INF/i18n/web-messages"
          p:defaultEncoding="utf-8"
          p:cacheSeconds="0" />

    <util:set id="thymeleafDialects">
        <bean class="nz.net.ultraq.thymeleaf.LayoutDialect" />
    </util:set>


    <!--///// Controllers /////-->

    <bean id="mainController" class="cz.cvut.zuul.oaas.controllers.MainController" />

    <!-- Override the default mappings for approval and error pages -->
    <bean id="accessConfirmationController" class="cz.cvut.zuul.oaas.controllers.AccessConfirmationController"
          p:clientsService-ref="clientsService" />
    
    <!-- Check Token Enpoint for Resource Servers -->
    <bean id="checkTokenEndpoint" class="cz.cvut.zuul.oaas.controllers.CheckTokenEndpoint"
          p:accessTokenDAO-ref="accessTokenDAO"
          p:clientsService-ref="clientsService" />

</beans>
